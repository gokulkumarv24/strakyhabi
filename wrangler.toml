name = "streaky-app-worker"
main = "worker/index.js"
compatibility_date = "2024-01-15"
compatibility_flags = ["nodejs_compat"]

# Environment variables
[env.production.vars]
ENVIRONMENT = "production"
JWT_SECRET = "your-super-secret-jwt-key-change-this-in-production"
API_VERSION = "v1"
CORS_ORIGINS = "https://yourdomain.com,https://www.yourdomain.com"
RATE_LIMIT_ENABLED = "true"
RATE_LIMIT_REQUESTS = "100"
RATE_LIMIT_WINDOW = "60000"

[env.staging.vars]
ENVIRONMENT = "staging"
JWT_SECRET = "staging-jwt-secret-key"
API_VERSION = "v1"
CORS_ORIGINS = "https://staging.yourdomain.com"
RATE_LIMIT_ENABLED = "true"
RATE_LIMIT_REQUESTS = "200"
RATE_LIMIT_WINDOW = "60000"

[env.development.vars]
ENVIRONMENT = "development"
JWT_SECRET = "dev-jwt-secret-key"
API_VERSION = "v1"
CORS_ORIGINS = "*"
RATE_LIMIT_ENABLED = "false"

# KV Namespaces for different environments
[[env.production.kv_namespaces]]
binding = "STREAKY_KV"
preview_id = "your-production-preview-kv-id"
id = "your-production-kv-id"

[[env.staging.kv_namespaces]]
binding = "STREAKY_KV"
preview_id = "your-staging-preview-kv-id"
id = "your-staging-kv-id"

[[env.development.kv_namespaces]]
binding = "STREAKY_KV"
preview_id = "your-dev-preview-kv-id"
id = "your-dev-kv-id"

# Cron triggers for background tasks
[[env.production.triggers]]
crons = ["0 */6 * * *"]  # Every 6 hours

[[env.staging.triggers]]
crons = ["0 */12 * * *"]  # Every 12 hours

# R2 bucket for file storage (if needed later)
[[env.production.r2_buckets]]
binding = "STREAKY_STORAGE"
bucket_name = "streaky-app-production"

[[env.staging.r2_buckets]]
binding = "STREAKY_STORAGE"
bucket_name = "streaky-app-staging"

# Durable Objects (if needed for real-time features)
# [[env.production.durable_objects]]
# bindings = [
#   { name = "STREAK_COUNTER", class_name = "StreakCounter" }
# ]

# Analytics engine (if available)
[[env.production.analytics_engine_datasets]]
binding = "STREAKY_ANALYTICS"

# Custom domains
[env.production]
routes = [
  "api.yourdomain.com/*",
  "streaky.yourdomain.com/api/*"
]

[env.staging]
routes = [
  "api.staging.yourdomain.com/*"
]

# Build configuration
[build]
command = "npm run build"
cwd = "worker"

# Limits and settings
[limits]
cpu_ms = 50

# Observability
[observability]
enabled = true

# Unsafe settings for development
[unsafe]
bindings = [
  { name = "DEBUG_MODE", type = "plain_text", text = "false" }
]

# Migration settings
[migrations]
tag = "v1.0.0"
new_classes = []
renamed_classes = []
deleted_classes = []
name = "streaky-worker"
main = "index.js"
compatibility_date = "2025-01-01"

# Environment variables
[vars]
JWT_SECRET = "your-256-bit-secret-key-replace-in-production"
APP_ENV = "development"
API_VERSION = "v1"

# KV Namespaces
[[kv_namespaces]]
binding = "USER_KV"
id = "your-kv-namespace-id"  # Replace with actual KV namespace ID
preview_id = "your-preview-kv-namespace-id"  # Replace with preview KV namespace ID

# D1 Database (optional for future use)
# [[d1_databases]]
# binding = "DB"
# database_name = "streaky-db"
# database_id = "your-d1-database-id"

# Durable Objects (for future real-time features)
# [[durable_objects.bindings]]
# name = "STREAK_SYNC"
# class_name = "StreakSync"

# Analytics Engine (optional)
# [analytics_engine_datasets]
# binding = "ANALYTICS"

# Custom routes
[routes]
pattern = "*.streaky-app.workers.dev/*"
zone_name = "streaky-app.workers.dev"

# Build configuration
[build]
command = ""

# Cron triggers for scheduled tasks
[[triggers.crons]]
cron = "0 0 * * *"  # Daily at midnight UTC
route = "/cron/daily-cleanup"

[[triggers.crons]]
cron = "0 */6 * * *"  # Every 6 hours
route = "/cron/analytics-aggregate"

# Limits and optimizations
[limits]
cpu_ms = 50000      # 50 seconds CPU time limit
memory_mb = 128     # 128 MB memory limit

# Preview configuration
[env.preview]
name = "streaky-worker-preview"

[env.preview.vars]
APP_ENV = "preview"

[[env.preview.kv_namespaces]]
binding = "USER_KV"
id = "your-preview-kv-namespace-id"
preview_id = "your-preview-kv-namespace-id"

# Production configuration
[env.production]
name = "streaky-worker"

[env.production.vars]
APP_ENV = "production"
JWT_SECRET = "your-production-secret-key"

[[env.production.kv_namespaces]]
binding = "USER_KV"
id = "your-production-kv-namespace-id"

# Development configuration
[env.development]
name = "streaky-worker-dev"

[env.development.vars]
APP_ENV = "development"

[[env.development.kv_namespaces]]
binding = "USER_KV"
id = "your-dev-kv-namespace-id"